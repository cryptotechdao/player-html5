<!DOCTYPE html>
<html>
    <head>
        <title>Player Musique</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
        <script src="js/jquery-1.11.3.js" type="text/javascript"></script>
        <script src="bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <link href="css/player.css" rel="stylesheet" type="text/css"/>

        <link rel="icon" type="image/png" href="image/icon/flavicon.png" />
        <style>



            .progress-bar-dynamic {
                margin-left: -5px;  /*-1/2 width */
                width: 10px;
                height: 10px;
                border-radius: 50%;
                margin-top: -3.3333px; /* 1/3 height */

            }

            .progress-dynamic {
                overflow: visible;
                height: 5px;
                width: 100px;
                cursor: pointer;
            }

            input[type="range"]{
                -webkit-appearance: none;
                border-radius: 6px;
                height: 6px;
                background-image: -webkit-gradient(
                    linear,
                    left top,
                    right top,
                    color-stop(0, #46b8da),
                    color-stop(0, #C5C5C5)
                    );
            }

            input[type='range']::-webkit-slider-thumb {
                -webkit-appearance: none !important;
                background-color: #31b0d5;
                // border: 1px solid #CECECE;
                height: 15px;
                width: 15px;
                border-radius: 50%;
            }
            input[type=range]:focus {
                outline: none;
            }

            #volume-bar {
                background-image: -webkit-gradient(
                    linear,
                    left top,
                    right top,
                    color-stop(0.6, #46b8da),
                    color-stop(0.6, #C5C5C5)
                    );
            }

        </style>
    </head>
    <body>
        <div class="container">
            <div class="jumbotron"> 
                <h1>Media player html5</h1>
            </div>


            <div style="width: 320px;">
                <audio id="audio" preload="none"> 
                </audio>
                <div class="control-bar" style="border-radius: 7px ">
                    <div id="btn-stop" class="btn btn-default btn-player btn-stop" style="margin-left: 5px;">
                    </div>
                    <div id="btn-backward" class="btn btn-default btn-player btn-backward">
                    </div>
                    <div id ="btn-play" class="btn btn-default btn-player btn-start">
                    </div>
                    <div id="btn-forward" class="btn btn-default btn-player btn-forward">
                    </div>

                    <div style="display: inline; margin-left: 35px;">
                        <div id="btn-playlist" class="btn btn-default btn-playlist">
                        </div>
                        <span class="glyphicon glyphicon-volume-up btn-mute" aria-hidden="true" style="font-size: 25px; margin-right: 0px; vertical-align: middle; cursor: pointer;"></span>

                        <div class="volume" >
                            <input id="volume-bar" type="range" min="0" max="1" step="0.1" value="0.6" style="cursor: pointer; margin-top: 15px; width: 50px;" >
                        </div>
                    </div>

                </div>
                <div class="col-xs-10" style="padding-left: 0; padding-right: 0">
                    <input id="track-progress" type="range" min="0" max="100" step="1" value="0" style="height: 7px; margin-top: 7px; width: 100%;  cursor: pointer;" >
                </div>

                <div id="time-track" class="col-xs-2 text-center" style="padding-left: 0; padding-right: 0">0:00</div>


                <table id ="play-list" style="width:100%" class="table table-condensed hide">


                </table>

            </div>
        </div>
        <script>


        </script>

        <script>
            var track_list = [
                {
                    "title": "Nothing Else Matters",
                    "artist": "Metallica",
                    "dure": "6:28",
                    "link": "https://cf-media.sndcdn.com/EFLJnI2AEupS.128.mp3?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiKjovL2NmLW1lZGlhLnNuZGNkbi5jb20vRUZMSm5JMkFFdXBTLjEyOC5tcDMiLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE0MzU5MDc5ODJ9fX1dfQ__&Signature=kjsJSolc5H7QaEgHYgdar0HY5Ira5umughT03m6BTEW3k8Pyy4aAnd~TzF0YNt0u14uXlxWdKXLGWozPXi15pJWOCvWJKRggxXLQ5qkEbHRr3ws1E0IsDlXmGPL~o58o5cMDB~sof4a9Fa-b0G3Zful-LND8CKEPlnm8~fdiJ~CSTAHiTzigVDEWZKNqtgx3MNoibEklDaThtFEw~hcvsoUAT33QxSdjQ7tU1DNhGUVLDblRTx9mf-NpO3aesKLiehXjYYBLsRZpNPQ1N4CyR4WuSwuvte6oyRm6h0xQ6E7OIycnNTzJKczXQ6Q8bviv7T0O0qmxdFtoh5Vl-HPtOg__&Key-Pair-Id=APKAJAGZ7VMH2PFPW6UQ"
                },
                {
                    "title": "Sweet Child O' Mine",
                    "artist": "Guns N' Roses",
                    "dure": "5:56",
                    "link": "https://cf-media.sndcdn.com/4qaBRdDBR6Tg.128.mp3?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiKjovL2NmLW1lZGlhLnNuZGNkbi5jb20vNHFhQlJkREJSNlRnLjEyOC5tcDMiLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE0MzU5MDgxODJ9fX1dfQ__&Signature=GtXLd7HnAwQTxfGKGYXNJWuVAc2sB~pOx-N--jLgueYG6dNpqiIQz1zRjV~Li87s1lQmQQNUxVQCLUEcVBCRNVCNGYNnFB6hzYKUs8ZY0uIHI~aCkWoXSr08vBAfnrVEIfDngcR~XY5QrqMHTVFuGcYIH-m8NMuW6ls-WV~SWD2NG1IOpaJtjG~~UrEvGa-Kn9pS5MC0xBUTM38AILZtHECFOYOKk52emV0NbtaLdlCCjz8DwTb8QuUamMEeOkTyORioUoY6TaUX8CnXIlLMLmPc2Wjh0umvXyQqn0bUYr9py8ktdG9HvuS1P~fujrcSkGnHLCC8etPvewrTRgSbaA__&Key-Pair-Id=APKAJAGZ7VMH2PFPW6UQ"
                },
                {
                    "title": "Forever",
                    "artist": "Stratovarius",
                    "dure": "3:13",
                    "link": "https://cf-media.sndcdn.com/uWXQciBcZWOP.128.mp3?Policy=eyJTdGF0ZW1lbnQiOlt7IlJlc291cmNlIjoiKjovL2NmLW1lZGlhLnNuZGNkbi5jb20vdVdYUWNpQmNaV09QLjEyOC5tcDMiLCJDb25kaXRpb24iOnsiRGF0ZUxlc3NUaGFuIjp7IkFXUzpFcG9jaFRpbWUiOjE0MzU5MDgyMzB9fX1dfQ__&Signature=b2cdsXdd1xSg2hBju5l3d3IjNBIiTPKoYF5vE2beP7B-KyWaKGKHLDuPF6GWo5meEcqWy9I1ydGRwEte0dhfVnHuTbGmfKmWhxbeNjYbpTAWJVf1xXUZUgekPLHN47suWzn50uStwnMJNF0IFT51VRz80MkpVvZtcW4bBAxydzwgES3MfLe5xn6pmT4KtmvnS~EwOgEXU8eHTvf8DKCP15JcsFMqM6YmELsUv4Fh8JwhAf0Pm3WH4OI29bUu07fKD1ugUvH0HZc7AxaoHaUJmjg3DVZmALPe3izLJd-Wk~6T1WNPcE~VNjB0Jpwp0XodiSUPBD7ekt9UmYP3roU8QA__&Key-Pair-Id=APKAJAGZ7VMH2PFPW6UQ"
                }
            ];
            var audio = document.querySelector("#audio");
            var current_song = 0;
            var $play_list = $("#play-list");
            var $audio = $("#audio");
            var $btn_play = $("#btn-play");
            var $btn_stop = $("#btn-stop");
            var $btn_backward = $("#btn-backward");
            var $btn_forward = $("#btn-forward");
            var $btn_mute = $(".btn-mute");
            var $volume_bar = $('#volume-bar');
            var $track_progress = $("#track-progress");
            var $btn_playlist = $("#btn-playlist");
            //$(this).addClass("current_play");

            loadNewTrackList($play_list, track_list);
            $("#" + current_song).addClass("current_play");

            $audio.prop("volume", 0.6);
            /////btn play
            $btn_play.click(function () {
                if (audio.paused)
                {
                    if ($audio.prop("currentTime") === 0) {
                        $("#play-list").removeClass("hide");
                    }
                    playTrack($btn_play, $audio, track_list[current_song].link);

                } else {
                    pauseTrack($btn_play, $audio);
                }

                $(".track").click(function () {
                    console.log("fuck");
                    $("#" + current_song).removeClass("current_play");
                    current_song = $(this).attr("id");
                    $audio.attr("src", track_list[current_song].link);
                    $audio.trigger('play');
                    $(this).addClass("current_play");
                });
            });

            ////btn stop
            $btn_stop.click(function () {
                pauseTrack($btn_play, $audio);
                $audio.prop("currentTime", 0);

            });

            ////// btn  backward
            $btn_backward.click(function () {
                $("#" + current_song).removeClass("current_play");
                current_song = current_song - 1;
                if (current_song < 0) {
                    current_song = track_list.length - 1;
                }
                $("#" + current_song).addClass("current_play");
                if (!audio.paused) {
                    playTrack($btn_play, $audio, track_list[current_song].link);
                }
            });

            ////// btn forward
            $btn_forward.click(function () {
                $("#" + current_song).removeClass("current_play");
                current_song = (current_song + 1) % track_list.length;
                if (!audio.paused) {
                    playTrack($btn_play, $audio, track_list[current_song].link);
                }
                $("#" + current_song).addClass("current_play");
            });


            ////// btn mute

            $btn_mute.click(function () {
                // console.log(audio.muted);
                if (audio.muted) {
                    console.log(audio.muted);
                    $(this).removeClass("glyphicon-volume-off");
                    $(this).addClass("glyphicon-volume-up");
                    audio.muted = false;
                    $volume_bar.val(10 * audio.volume);
                } else {
                    console.log(audio.muted);
                    $(this).removeClass("glyphicon-volume-up");
                    $(this).addClass("glyphicon-volume-off");
                    audio.muted = true;
                    $volume_bar.val(0);
                }
            });

            $volume_bar.change(function () {
                audio.volume = $volume_bar.val();
                slider_ui($volume_bar, audio.volume);

                if (audio.volume === 0) {
                    $btn_mute.removeClass("glyphicon-volume-up");
                    $btn_mute.addClass("glyphicon-volume-off");
                } else {
                    $btn_mute.removeClass("glyphicon-volume-off");
                    $btn_mute.addClass("glyphicon-volume-up");
                }
            });

            //slider_ui($track_progress, 0);

            $audio.bind("progress", function () {
                var duration = $audio.prop('duration');
                var time = $audio.prop('currentTime');
                var fraction = time / duration;
                slider_ui($track_progress, fraction);
                $track_progress.val(100 * fraction);
                $("#time-track").html(formatTime(time));

            });

            $track_progress.bind("change", function () {
                var x = $track_progress.val();
                console.log(x);
                var d = audio.duration;
                console.log(d);
                $audio.prop('currentTime', d * x / 100);
                c = audio.currentTime;
                console.log(100 * c / d);
                slider_ui($track_progress, c / d);
            });



            //// btn play list $btn_playlist
            $btn_playlist.click(function () {
                if ($play_list.hasClass("hide")) {
                    $play_list.removeClass("hide");
                } else {
                    $play_list.addClass("hide");
                }


                $(".track").click(function () {
                    $("#" + current_song).removeClass("current_play");
                    current_song = $(this).attr("id");
                    $audio.attr("src", track_list[current_song].link);
                    $audio.trigger('play');
                    $(this).addClass("current_play");
                });
            });



            $("#audio").bind("ended", function () {
                // alert("end");
                $(".track").removeClass("current_play");
                current_song = parseInt(current_song) + 1;
                console.log(current_song);
                console.log(track_list.length);
                console.log(current_song === track_list.length);
                if (current_song === track_list.length) {
                    $("#btn-play").removeClass("btn-pause");
                    $("#btn-play").addClass("btn-start");
                    current_song = 0;
                    $("#" + current_song).addClass("current_play");
                    return;
                }
                $("#audio").attr("src", track_list[current_song].link);
                $("#audio").trigger('play');
                $("#" + current_song).addClass("current_play");
            });



            function loadNewTrackList(play_list, new_track_list) {
                $.each(new_track_list, function (i, song) {
                    play_list.append("<tr id=" + i + " class='track'>  \n\
                            <td width='5%'>" + (i + 1) +
                            "</td><td width='90%'>" + new_track_list[i].title + " - <i>" +
                            new_track_list[i].artist + "<i></td> <td width='5%'>" + new_track_list[i].dure +
                            "</td></tr>");
                });
            }

            function playTrack(_btn_play, _audio, track_link) {
                _btn_play.removeClass("btn-start");
                _btn_play.addClass("btn-pause");
                if (_audio.attr("src") !== track_link) {
                    _audio.attr("src", track_link);
                }
                _audio.trigger('play');
            }

            function pauseTrack(_btn_play, _audio) {
                _btn_play.removeClass("btn-pause");
                _btn_play.addClass("btn-start");
                _audio.trigger('pause');
            }

            function slider_ui(slider, temp) {
                slider.css('background-image',
                        '-webkit-gradient(linear, left top, right top, '
                        + 'color-stop(' + temp + ', #46b8da), '
                        + 'color-stop(' + temp + ', #C5C5C5)'
                        + ')'
                        );
            }


            function formatTime(time) {
                var hours = Math.floor(time / 3600);
                var mins = Math.floor((time % 3600) / 60);
                var secs = Math.floor(time % 60);
                if (secs < 10) {
                    secs = "0" + secs;
                }

                if (hours) {
                    if (mins < 10) {
                        mins = "0" + mins;
                    }

                    return hours + ":" + mins + ":" + secs; // hh:mm:ss
                } else {
                    return mins + ":" + secs; // mm:ss
                }
            }
        </script>
    </body>
</html>

